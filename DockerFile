# Step 1: Build the Frontend
FROM node:18 AS build

# Set working directory for frontend build
WORKDIR /app

# Copy package.json and install dependencies
COPY "Admin Ui Template/package.json" "Admin Ui Template/"
RUN cd "Admin Ui Template" && npm install

# Copy the rest of your frontend files and build
COPY "Admin Ui Template" "Admin Ui Template/"
RUN cd "Admin Ui Template" && npm run build

# Step 2: Set Up PHP Backend
FROM php:8.0-apache

# Install necessary PHP extensions
RUN docker-php-ext-install mysqli

# Set the working directory for Apache
WORKDIR /var/www/html

# Copy backend files to Apache server directory
COPY ajax/ /var/www/html/

# Copy the database connection file
COPY dbconnection.php /var/www/html/

# Copy the built frontend files from the build stage
COPY --from=build /app/Admin\ Ui\ Template/build /var/www/html/frontend

# Expose port 80
EXPOSE 80

# Start Apache server
CMD ["apache2-foreground"]
